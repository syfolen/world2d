var __extends=this&&this.__extends||function(){var i=function(t,e){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r]};return i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();var world2d;(function(t){var n;(function(t){t[t["CIRCLE"]=0]="CIRCLE";t[t["POLYGON"]=1]="POLYGON"})(n=t.ColliderShapEnum2D||(t.ColliderShapEnum2D={}));var p;(function(t){t[t["DEFAULT"]=1]="DEFAULT";t[t["FISH"]=2]="FISH";t[t["BULLET"]=4]="BULLET";t[t["POLYGON"]=8]="POLYGON";t[t["CIRCLE"]=16]="CIRCLE";t[t["RECTANLE"]=32]="RECTANLE";t[t["FISH_2"]=64]="FISH_2";t[t["BULLET_2"]=128]="BULLET_2";t[t["ALL"]=4096]="ALL"})(p=t.CollisionLayerEnum||(t.CollisionLayerEnum={}));var y;(function(t){t[t["CIRCLE"]=0]="CIRCLE";t[t["POLYGON"]=1]="POLYGON";t[t["RECTANGLE"]=2]="RECTANGLE"})(y=t.CollisionShapEnum2D||(t.CollisionShapEnum2D={}));var s;(function(t){t[t["COLLISION_ENTER"]=0]="COLLISION_ENTER";t[t["COLLISION_STAY"]=1]="COLLISION_STAY";t[t["COLLISION_EXIT"]=2]="COLLISION_EXIT"})(s=t.CollisionType||(t.CollisionType={}));var h=function(){function t(){}t.prototype.updateBounds=function(t,e,r,i){this.left=t;this.right=e;this.top=r;this.bottom=i};return t}();t.Bounds=h;var e=function(){function t(t){this.$shap=t}Object.defineProperty(t.prototype,"shap",{get:function(){return this.$shap},enumerable:true,configurable:true});return t}();t.Collider2D=e;var r=function(r){__extends(t,r);function t(t){var e=r.call(this,n.CIRCLE)||this;e.radius=t;return e}t.prototype.clone=function(){return new t(this.radius)};return t}(e);t.ColliderCircle2D=r;var i=function(r){__extends(i,r);function i(t){var e=r.call(this,n.POLYGON)||this;e.vertexs=t;return e}i.prototype.clone=function(){var t=[];for(var e=0;e<this.vertexs.length;e++){t.push(this.vertexs[e].copy())}return new i(t)};return i}(e);t.ColliderPolygon2D=i;var o=function(){function t(t){this.bounds=new h;this.$shap=t}Object.defineProperty(t.prototype,"shap",{get:function(){return this.$shap},enumerable:true,configurable:true});return t}();t.Collision2D=o;var a=function(r){__extends(t,r);function t(t){var e=r.call(this,y.CIRCLE)||this;e.radius=t;return e}t.prototype.updateBounds=function(){this.bounds.updateBounds(this.x-this.radius,this.x+this.radius,this.y-this.radius,this.y+this.radius)};return t}(o);t.CollisionCircle2D=a;var u=function(){function t(t,e){this.useBox2d=false;this.$testAABB=true;this.$touching=false;if(t.collision.shap===y.CIRCLE){this.$a=t;this.$b=e;if(e.collision.shap===y.CIRCLE){this.$testFunc=this.$c2c;this.$testAABB=false}else if(e.collision.shap===y.RECTANGLE){this.$testFunc=this.$c2r}else{this.$testFunc=this.$c2p}}else if(t.collision.shap===y.RECTANGLE){if(e.collision.shap===y.CIRCLE){this.$a=e;this.$b=t;this.$testFunc=this.$c2r}else if(e.collision.shap===y.RECTANGLE){this.$a=t;this.$b=e;this.$testFunc=this.$r2r;this.$testAABB=false}else{this.$a=t;this.$b=e;this.$testFunc=this.$r2p}}else{this.$a=e;this.$b=t;if(e.collision.shap===y.CIRCLE){this.$testFunc=this.$c2p}else if(e.collision.shap===y.RECTANGLE){this.$testFunc=this.$r2p}else{this.$testFunc=this.$p2p}}}t.prototype.test=function(){var t=this.$a;var e=this.$b;if(t.enabled===false||e.enabled===false){return}var r,i;if(t.rigidbody!==null){r=t;i=e}else{r=e;i=t}if(r.rigidbody.target!==null&&r.rigidbody.target!==i){return}var n=this.$testAABB==false?true:c.bounds2Bounds(t.collision.bounds,e.collision.bounds);if(n===true){n=this.$testFunc.call(this,t.collision,e.collision)}if(n===true){if(this.$touching===false){this.$touching=true;this.doCollide(s.COLLISION_ENTER)}else{this.doCollide(s.COLLISION_STAY)}}else if(this.$touching===true){this.$touching=false;this.doCollide(s.COLLISION_EXIT)}};t.prototype.doCollide=function(t){var e=this.$a;var r=this.$b;if(t===s.COLLISION_ENTER){e.hitNum++;r.hitNum++;e.entity.onCollisionEnter(r.entity);r.entity.onCollisionEnter(e.entity)}else if(t===s.COLLISION_EXIT){e.hitNum--;r.hitNum--;e.entity.onCollisionExit(r.entity);r.entity.onCollisionExit(e.entity)}else{e.entity.onCollisionStay(r.entity);r.entity.onCollisionStay(e.entity)}};t.prototype.$c2c=function(t,e){return c.circle2Circle(t,e)};t.prototype.$c2r=function(t,e){return c.circle2Polygin(t,e)};t.prototype.$c2p=function(t,e){var r;if(this.useBox2d===true){r=v.circle2Polygon(t,t.radius,e.vertexs)}else{r=c.circle2Polygin(t,e)}return r};t.prototype.$r2r=function(){return c.bounds2Bounds(this.$a.collision.bounds,this.$b.collision.bounds)};t.prototype.$r2p=function(t,e){if(this.useBox2d===true){return v.polygon2Polygon(t.vertexs,e.vertexs)}return c.polygon2Vertexs(e,t.vertexs)};t.prototype.$p2p=function(t,e){if(this.useBox2d===true){return v.polygon2Polygon(t.vertexs,e.vertexs)}return c.polygon2Vertexs(t,e.vertexs)&&c.polygon2Vertexs(e,t.vertexs)};Object.defineProperty(t.prototype,"a",{get:function(){return this.$a},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"b",{get:function(){return this.$b},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"touching",{get:function(){return this.$touching},enumerable:true,configurable:true});return t}();t.CollisionContact2D=u;var l=function(n){__extends(t,n);function t(t){var e=n.call(this,y.POLYGON)||this;e.$tempVertexs=null;e.vertexs=[];e.segments=[];for(var r=0;r<t.vertexs.length;r++){var i=t.vertexs[r];e.vertexs.push(i.copy());e.segments.push(new L(0,0))}return e}t.prototype.updateBounds=function(){x.calculateBoundsForVertexs(this.vertexs,this.bounds)};t.prototype.updateVertexs=function(t){this.$tempVertexs=t};t.prototype.prepareVertexs=function(){for(var t=0;t<this.$tempVertexs.length;t++){var e=this.vertexs[t];var r=this.$tempVertexs[t];e.assign(r.x,r.y)}this.$tempVertexs=null};t.prototype.prepareSegments=function(){for(var t=0;t<this.vertexs.length;t++){var e=this.vertexs[t];var r=t>0?this.vertexs[t-1]:this.vertexs[this.vertexs.length-1];this.segments[t].assign(e.x-r.x,e.y-r.y)}};Object.defineProperty(t.prototype,"modified",{get:function(){return this.$tempVertexs!==null},enumerable:true,configurable:true});return t}(o);t.CollisionPolygon2D=l;var f=function(r){__extends(t,r);function t(){var t=r.call(this,y.RECTANGLE)||this;t.vertexs=[];t.segments=[];for(var e=0;e<4;e++){t.vertexs.push(new L(0,0));t.segments.push(new L(0,0))}return t}t.prototype.updateBounds=function(){x.calculateBoundsForVertexs(this.vertexs,this.bounds)};t.prototype.prepareVertexs=function(){this.vertexs[0].assign(this.bounds.left,this.bounds.bottom);this.vertexs[1].assign(this.bounds.right,this.bounds.bottom);this.vertexs[2].assign(this.bounds.right,this.bounds.top);this.vertexs[3].assign(this.bounds.left,this.bounds.top)};t.prototype.prepareSegments=function(){for(var t=0;t<this.vertexs.length;t++){var e=this.vertexs[t];var r=t>0?this.vertexs[t-1]:this.vertexs[this.vertexs.length-1];this.segments[t].assign(e.x-r.x,e.y-r.y)}};return t}(o);t.CollisionRectangle2D=f;var c=function(){function g(){}g.bounds2Bounds=function(t,e){if(t.left>e.right||e.left>t.right||t.top>e.bottom||e.top>t.bottom){return false}return true};g.circle2Circle=function(t,e){var r=e.x-t.x;var i=e.y-t.y;var n=t.radius+e.radius;if(r*r+i*i>n*n){return false}return true};g.circle2Polygin=function(t,e){var r=e.vertexs;var i=t.radius*t.radius;var n=null;var o=Number.MAX_VALUE;var s=false;for(var a=0;a<r.length;a++){var u=r[a];var l=u.distanceToSquared(t);if(l<=i){s=true;break}if(l<o){n=u;o=l}}if(s===true){return true}var h=new L(t.x,t.y);var f=n.copy();var c=new L(f.x-h.x,f.y-h.y);var p=c.normal();var y=c.copy().normalize().mul(t.radius).add(h);if(g.$vertex2VertexInDirection([y],r,p)===false){return false}var v=[h,f];var d=e.segments;for(var a=0;a<d.length;a++){var x=d[a];if(x.length()===0){continue}p.assign(x.y,-x.x).normalize().mul(t.radius);h.assign(t.x,t.y).add(p);f.assign(t.x,t.y).sub(p);if(g.$vertex2VertexInDirection(v,r,x)===false){return false}}return true};g.$vertex2VertexInDirection=function(t,e,r){var i=r.y/r.x;var n=r.x/r.y;var o=Number.MAX_VALUE;var s=-Number.MAX_VALUE;var a=Number.MAX_VALUE;var u=-Number.MAX_VALUE;var l=0,h=0;var f=false;if(i<-1||i>1){while(l<t.length||h<e.length){if(l<t.length){var c=t[l];var p=c.x-n*c.y;if(o>p){o=p}if(s<p){s=p}l++}if(h<e.length){var c=e[h];var p=c.x-n*c.y;if(a>p){a=p}if(u<p){u=p}h++}if((s<a||o>u)===false){f=true;break}}}else{while(l<t.length||h<e.length){if(l<t.length){var c=t[l];var p=c.y-i*c.x;if(o>p){o=p}if(s<p){s=p}l++}if(h<e.length){var c=e[h];var p=c.y-i*c.x;if(a>p){a=p}if(u<p){u=p}h++}if((s<a||o>u)===false){f=true;break}}}return f};g.polygon2Vertexs=function(t,e){var r=t.vertexs;var i=t.segments;for(var n=0;n<i.length;n++){var o=i[n];if(o.length()===0){continue}if(g.$vertex2VertexInDirection(r,e,i[n])===false){return false}}return true};g.line2Line=function(t,e,r,i,n,o){return g.isLineBetweenPoints(e,t,n,o)&&g.isLineBetweenPoints(n,i,e,r)};g.isLineBetweenPoints=function(t,e,r,i){if(e.x===0){return g.isXbetweenAandB(t.x,r.x,i.x)}else if(e.y===0){return g.isXbetweenAandB(t.y,r.y,i.y)}else{var n=e.y/e.x;if(n>-1&&n<1){var o=t.y-n*t.x;var s=r.y-n*r.x;var a=i.y-n*i.x;return g.isXbetweenAandB(o,s,a)}else{var u=e.x/e.y;var l=t.x-u*t.y;var h=r.x-u*r.y;var f=i.x-u*i.y;return g.isXbetweenAandB(l,h,f)}}};g.isXbetweenAandB=function(t,e,r){if(e>r){var i=e;e=r;r=i}if(e<=t&&t<=r){return true}return false};return g}();t.CollisionResolution2D=c;var v=function(){function u(){}u.testBounds=function(t,e){if(t.left>e.right||t.right<e.left||t.top<e.bottom||t.bottom>e.top){return false}return true};u.circle2Polygon=function(t,e,r){var i=t;if(u.pointInPolygon(i,r)){return true}for(var n=0,o=r.length;n<o;n++){var s=n===0?r[r.length-1]:r[n-1];var a=r[n];if(u.pointLineDistance(i,s,a,true)<e){return true}}return false};u.polygon2Polygon=function(t,e){var r,i;for(r=0,i=t.length;r<i;++r){var n=t[r];var o=t[(r+1)%i];if(u.line2Polygon(n,o,e))return true}for(r=0,i=e.length;r<i;++r){if(u.pointInPolygon(e[r],t))return true}for(r=0,i=t.length;r<i;++r){if(u.pointInPolygon(t[r],e))return true}return false};u.pointInPolygon=function(t,e){var r=false;var i=t.x;var n=t.y;var o=e.length;for(var s=0,a=o-1;s<o;a=s++){var u=e[s].x,l=e[s].y,h=e[a].x,f=e[a].y,c=l>n!==f>n&&i<(h-u)*(n-l)/(f-l)+u;if(c)r=!r}return r};u.pointLineDistance=function(t,e,r,i){var n=r.x-e.x;var o=r.y-e.y;var s=n*n+o*o;var a=((t.x-e.x)*n+(t.y-e.y)*o)/s;var u;if(!i){u=new L(e.x+a*n,e.y+a*o)}else{if(s){if(a<0)u=e;else if(a>1)u=r;else u=new L(e.x+a*n,e.y+a*o)}else{u=e}}n=t.x-u.x;o=t.y-u.y;return Math.sqrt(n*n+o*o)};u.line2Polygon=function(t,e,r){var i=r.length;for(var n=0;n<i;++n){var o=r[n];var s=r[(n+1)%i];if(u.line2Line(t,e,o,s))return true}return false};u.line2Line=function(t,e,r,i){var n=(i.y-r.y)*(e.x-t.x)-(i.x-r.x)*(e.y-t.y);if(n!==0){var o=(i.x-r.x)*(t.y-r.y)-(i.y-r.y)*(t.x-r.x);var s=(e.x-t.x)*(t.y-r.y)-(e.y-t.y)*(t.x-r.x);var a=o/n;var u=s/n;if(0<=a&&a<=1&&0<=u&&u<=1){return true}}return false};return u}();t.CollisionResolutionBox2D=v;var d=function(){function a(){}a.clear=function(){a.graphics.clear()};a.draw=function(t){for(var e=0;e<t.length;e++){var r=t[e];var i=r.collision.bounds;a.drawRect(i.left,i.top,i.right-i.left,i.bottom-i.top,"#FF0000")}for(var e=0;e<t.length;e++){var r=t[e];if(r.collision.shap===y.CIRCLE){var n=r.collision;a.drawCircle(r.x,r.y,n.radius,"#FF0000")}else if(r.collision.shap===y.POLYGON){var n=r.collision;a.drawPolygon(0,0,n.vertexs,"#FF0000")}else{var n=r.collision;a.drawPolygon(0,0,n.vertexs,"#FF0000")}}for(var e=0;e<t.length;e++){var r=t[e];var o=r.hitNum===0?"#0000FF":"#00FF00";if(r.collision.shap===y.CIRCLE){var n=r.collision;a.drawCircle(r.x,r.y,n.radius,o)}else if(r.collision.shap===y.POLYGON){var n=r.collision;a.drawPolygon(0,0,n.vertexs,o)}else{var i=r.collision.bounds;a.drawRect(i.left,i.top,i.right-i.left,i.bottom-i.top,o)}}};a.drawLine=function(t,e,r){a.graphics.drawLine(t.x,t.y,e.x,e.y,r)};a.drawNormal=function(t,e){var r=t.copy().normalize().mul(1e3);a.graphics.drawLine(t.x,t.y,-t.x,-t.y,e)};a.drawRect=function(t,e,r,i,n){a.graphics.drawRect(t,e,r,i,void 0,n)};a.drawCircle=function(t,e,r,i){a.graphics.drawCircle(t,e,r,void 0,i)};a.drawPolygon=function(t,e,r,i){for(var n=0;n<r.length;n++){var o=r[n];var s=n===0?r[r.length-1]:r[n-1];a.graphics.drawLine(o.x+t,o.y+e,s.x+t,s.y+e,i)}};return a}();t.DrawAPI2D=d;var x=function(){function t(){}t.d2r=function(t){return t*Math.PI/180};t.r2d=function(t){return t*180/Math.PI};t.abs=function(t){if(t<0){return-t}return t};t.min=function(t,e){return t<e?t:e};t.max=function(t,e){return t>e?t:e};t.calculateBoundsForVertexs=function(t,e){var r=t[0];var i=r.x;var n=r.x;var o=r.y;var s=r.y;for(var a=1;a<t.length;a++){var u=t[a];if(i>u.x){i=u.x}else if(n<u.x){n=u.x}if(o>u.y){o=u.y}else if(s<u.y){s=u.y}}e.updateBounds(i,n,o,s)};t.PI=Math.PI;t.PI2=Math.PI*2;return t}();t.Helper2D=x;var g=function(){function t(){}t.testPoint=function(t,e){if(e===void 0){e=p.ALL}var r=C.inst.transforms.slice(0);for(var i=0;i<r.length;i++){var n=r[i];var o=n.collision;if(e!==p.ALL&&e!==n.layer){continue}if(n.collision.shap===y.CIRCLE){if(t.distanceTo(n)<=o.radius){return n}}else if(n.collision.shap===y.RECTANGLE){var s=n.collision.bounds;if(t.x>=s.left&&t.x<=s.right&&t.y>=s.top&&t.y<=s.bottom){return n}}else{var a=n.collision;var u=a.vertexs;var l=0;for(var h=0;h<u.length;h++){var f=u[h];var c=h===0?u[u.length-1]:u[h-1];if(f.x===c.x&&f.y===c.y){continue}l+=L.angle(L.sub(f,t),L.sub(c,t))}if(x.abs(x.r2d(l)-360)<.1){return n}}}return null};t.raycast=function(t,e,r,i){var n=e.copy().normalize().mul(r).add(t);d.drawLine(t,n,"#FF0000");var o=new h;o.updateBounds(x.min(t.x,n.x),x.max(t.x,n.x),x.max(t.y,n.y),x.max(t.y,n.y));var s=C.inst.transforms;var a=i&p.ALL?null:[];if(a===null){a=s.concat()}else{for(var u=0;u<s.length;u++){var l=s[u];if((l.layer&i)===0){continue}if(c.bounds2Bounds(o,l.collision.bounds)===false){continue}a.push(l)}}};return t}();t.Physics=g;var $=function(){function t(){this.$torque=180;this.target=null;this.moveSpeed=0}t.prototype.update=function(t){if(this.moveSpeed===0){return}if(this.target!==null&&this.target.enabled===false){this.target=null}var e=suncom.Pool.getItemByClass("world2d.Vector2D",L,[0,0]);if(this.target!==null){e.assign(this.target.x-this.transform.x,this.target.y-this.transform.y);var r=e.angle();if(this.$torque===180){this.transform.rotateTo(r)}else{var i=this.transform.rotation-x.PI;var n=this.transform.rotation+x.PI;if(r<i){r+=x.PI2}else if(r>n){r-=x.PI2}var o=r-this.transform.rotation;var s=suncom.Common.clamp(this.$torque*t*10,0,x.PI);if(o<-s){this.transform.rotateBy(-s)}else if(o>s){this.transform.rotateBy(s)}else{this.transform.rotateBy(o)}}}e.assign(this.moveSpeed,0).rotate(this.transform.rotation);this.transform.moveBy(e.x*t,e.y*t);suncom.Pool.recover("world2d.Vector2D",e)};Object.defineProperty(t.prototype,"torque",{get:function(){return x.r2d(this.$torque)},set:function(t){this.$torque=x.d2r(t)},enumerable:true,configurable:true});return t}();t.Rigidbody2D=$;var b=function(){function t(){this.a=new L(0,0);this.b=new L(0,0);this.ab=new L(0,0)}return t}();t.Segment2D=b;var m=function(o){__extends(t,o);function t(t,e,r,i){var n=o.call(this)||this;n.$x=0;n.$y=0;n.$scaleTo=1;n.$rotateTo=0;n.$rotation=0;n.$enabled=true;n.$entity=null;n.$rigidbody=null;n.hitNum=0;n.$entity=t;n.$collider=e;n.$rigidbody=r;n.$collision=i;if(r!==null){r.transform=n}return n}t.prototype.transform=function(t){if(this.$rigidbody!==null){this.$rigidbody.update(t)}var e=this.$needUpdate();var r=this.$isModifiedByExtern();if(e===false&&r===false){return}this.$scale=this.$scaleTo;this.$radian=this.$rotateTo;this.$collision.x=this.$x;this.$collision.y=this.$y;if(r===false){this.$applyScale();this.$applyRotate();this.$applyPosition()}else{var i=this.$collision;i.prepareVertexs()}this.$updateCollision()};t.prototype.moveBy=function(t,e){this.$x+=t;this.$y+=e};t.prototype.moveTo=function(t,e){this.$x=t;this.$y=e};t.prototype.scaleBy=function(t){this.$scaleTo*=t};t.prototype.scaleTo=function(t){this.$scaleTo=t};t.prototype.rotateBy=function(t){this.$updateRadian(this.$rotateTo+t)};t.prototype.rotateTo=function(t){this.$updateRadian(t)};t.prototype.$updateRadian=function(t){if(t<0){t%=x.PI2;t+=x.PI2}else if(t>=x.PI2){t%=x.PI2}if(this.$rotateTo!==t){this.$rotateTo=t;this.$rotation=x.r2d(t)}};t.prototype.$updateCollision=function(){this.$collision.updateBounds();if(this.$collision.shap===y.POLYGON){var t=this.$collision;t.prepareSegments()}else if(this.$collision.shap===y.RECTANGLE){var t=this.$collision;t.prepareVertexs();t.prepareSegments()}};t.prototype.$applyPosition=function(){if(this.$collider.shap!==n.CIRCLE){var t=this.$collision;for(var e=0;e<t.vertexs.length;e++){var r=t.vertexs[e];r.x+=this.$x;r.y+=this.$y}}};t.prototype.$applyRotate=function(){if(this.$collider.shap===n.POLYGON){var t=this.$collision;for(var e=0;e<t.vertexs.length;e++){var r=t.vertexs[e];r.rotate(this.$radian)}}};t.prototype.$applyScale=function(){if(this.$collision.shap===y.CIRCLE){var t=this.$collider;var e=this.$collision;e.radius=t.radius*this.$scale}else{var t=this.$collider;var e=this.$collision;for(var r=0;r<t.vertexs.length;r++){var i=t.vertexs[r];var n=e.vertexs[r];n.assign(i.x,i.y).mul(this.$scale)}}};t.prototype.$needUpdate=function(){if(this.$scale!==this.$scaleTo){return true}else if(this.$radian!==this.$rotateTo){return true}else if(this.$x!==this.$collision.x||this.$y!==this.$collision.y){return true}else{return false}};t.prototype.$isModifiedByExtern=function(){if(this.$collision.shap===y.POLYGON){var t=this.$collision;return t.modified}return false};t.prototype.getRotation=function(){return this.$rotation};t.prototype.setRotation=function(t){this.rotateTo(x.d2r(t))};t.prototype.disabled=function(){this.$enabled=false};Object.defineProperty(t.prototype,"layer",{get:function(){return this.$layer},set:function(t){this.$layer=t;this.dispatchEvent(C.TRANSFORM_LAYER_CHANGED,this)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this.$x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this.$y},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scale",{get:function(){return this.$scaleTo},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rotation",{get:function(){return this.$rotateTo},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"enabled",{get:function(){return this.$enabled},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"entity",{get:function(){return this.$entity},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"collider",{get:function(){return this.$collider},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"collision",{get:function(){return this.$collision},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rigidbody",{get:function(){return this.$rigidbody},enumerable:true,configurable:true});return t}(suncom.EventSystem);t.Transform2D=m;var L=function(){function r(t,e){this.x=t;this.y=e}r.prototype.assign=function(t,e){this.x=t;this.y=e;return this};r.prototype.add=function(t){this.x+=t.x;this.y+=t.y;return this};r.prototype.sub=function(t){this.x-=t.x;this.y-=t.y;return this};r.prototype.mul=function(t){this.x*=t;this.y*=t;return this};r.prototype.dot=function(t){return this.x*t.x+this.y*t.y};r.prototype.cross=function(t){return this.x*t.y-this.y*t.x};r.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};r.prototype.rotate=function(t){var e=this.x;var r=this.y;var i=Math.cos(t);var n=Math.sin(t);this.x=e*i-r*n;this.y=e*n+r*i;return this};r.prototype.angle=function(){var t=Math.atan2(this.y,this.x);if(t<0){return t+2*Math.PI}else{return t}};r.prototype.zero=function(){this.x=this.y=0;return this};r.prototype.normal=function(){return new r(this.y,-this.x)};r.prototype.normalize=function(){var t=this.length();if(t<1e-9){return this}this.x/=t;this.y/=t;return this};r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y};r.prototype.distanceTo=function(t){var e=this.x-t.x;var r=this.y-t.y;return Math.sqrt(e*e+r*r)};r.prototype.distanceToSquared=function(t){var e=this.x-t.x;var r=this.y-t.y;return e*e+r*r};r.prototype.copy=function(){return new r(this.x,this.y)};r.prototype.toString=function(){return"{"+this.x+","+this.y+"}"};r.add=function(t,e){return new r(t.x+e.x,t.y+e.y)};r.sub=function(t,e){return new r(e.x-t.x,e.y-t.y)};r.normal=function(t,e){return new r(e.y-t.y,t.x-e.x)};r.angle=function(t,e){var r=t.length();var i=e.length();if(r<=1e-9||i<1e-9){return 0}return Math.acos(t.dot(e)/(r*i))};return r}();t.Vector2D=L;var C=function(){function o(t){this.$detectors=[];this.$contacts=[];this.$transforms=[];o.inst=this;d.graphics=t;this.addDetector(p.DEFAULT,p.DEFAULT)}o.prototype.update=function(t){for(var e=0;e<this.$transforms.length;e++){this.$transforms[e].transform(t)}for(var e=0;e<this.$contacts.length;e++){this.$contacts[e].test()}o.DEBUG===true&&d.draw(this.$transforms)};o.prototype.addTransform=function(t,e){if(e===void 0){e=p.DEFAULT}t.layer=e;t.addEventListener(o.TRANSFORM_LAYER_CHANGED,this.$onTransformLayerChanged,this);for(var r=0;r<this.$transforms.length;r++){var i=this.$transforms[r];if(this.$shouldCollide(t.layer,i.layer)===true){var n=new u(t,i);this.$contacts.push(n)}}this.$transforms.push(t)};o.prototype.removeTransform=function(t){var e=this.$transforms.indexOf(t);if(e<0){return}t.disabled();this.$transforms.splice(e,1);t.removeEventListener(o.TRANSFORM_LAYER_CHANGED,this.$onTransformLayerChanged,this);for(var r=this.$contacts.length-1;r>-1;r--){var i=this.$contacts[r];if(i.a===t||i.b===t){if(i.touching===true){i.doCollide(s.COLLISION_EXIT)}this.$contacts.splice(r,1)}}};o.prototype.$onTransformLayerChanged=function(t){this.removeTransform(t);this.addTransform(t,t.layer)};o.prototype.addDetector=function(t,e){if(t>e){var r=t;t=e;e=r}if(this.$detectors[t]===void 0){this.$detectors[t]=[]}this.$detectors[t][e]=true};o.prototype.$shouldCollide=function(t,e){if(t>e){var r=t;t=e;e=r}if(this.$detectors[t]!==void 0&&this.$detectors[t][e]===true){return true}return false};Object.defineProperty(o.prototype,"transforms",{get:function(){return this.$transforms},enumerable:true,configurable:true});o.DEBUG=false;o.TRANSFORM_LAYER_CHANGED="world2d.TRANSFORM_LAYER_CHANGED";return o}();t.World2D=C})(world2d||(world2d={}));