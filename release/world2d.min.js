var __extends=this&&this.__extends||function(){var i=function(t,e){i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)if(e.hasOwnProperty(r))t[r]=e[r]};return i(t,e)};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}}();var world2d;(function($){var n;(function(t){t[t["CIRCLE"]=0]="CIRCLE";t[t["POLYGON"]=1]="POLYGON"})(n=$.ColliderShapEnum2D||($.ColliderShapEnum2D={}));var s;(function(t){t[t["DEFAULT"]=1]="DEFAULT";t[t["FISH"]=2]="FISH";t[t["BULLET"]=4]="BULLET";t[t["POLYGON"]=8]="POLYGON";t[t["CIRCLE"]=16]="CIRCLE";t[t["RECTANLE"]=32]="RECTANLE";t[t["FISH_2"]=64]="FISH_2";t[t["BULLET_2"]=128]="BULLET_2"})(s=$.CollisionLayerEnum||($.CollisionLayerEnum={}));var x;(function(t){t[t["CIRCLE"]=0]="CIRCLE";t[t["POLYGON"]=1]="POLYGON";t[t["RECTANGLE"]=2]="RECTANGLE"})(x=$.CollisionShapEnum2D||($.CollisionShapEnum2D={}));var a;(function(t){t[t["COLLISION_ENTER"]=0]="COLLISION_ENTER";t[t["COLLISION_STAY"]=1]="COLLISION_STAY";t[t["COLLISION_EXIT"]=2]="COLLISION_EXIT"})(a=$.CollisionType||($.CollisionType={}));var m;(function(t){t[t["NONE"]=0]="NONE";t[t["CROSS"]=1]="CROSS";t[t["CROSS_2"]=2]="CROSS_2";t[t["OVERLAP"]=3]="OVERLAP"})(m=$.CrossTypeEnum||($.CrossTypeEnum={}));var b;(function(t){t[t["ANY"]=0]="ANY";t[t["CLOSEST"]=1]="CLOSEST";t[t["ALL"]=2]="ALL";t[t["ALL_CLOSEST"]=3]="ALL_CLOSEST"})(b=$.RaycastTypeEnum||($.RaycastTypeEnum={}));var g=function(){function t(){}t.prototype.updateBounds=function(t,e,r,i){this.left=t;this.right=e;this.top=r;this.bottom=i};return t}();$.Bounds=g;var t=function(){function t(t){this.$shap=t}Object.defineProperty(t.prototype,"shap",{get:function(){return this.$shap},enumerable:true,configurable:true});return t}();$.Collider2D=t;var e=function(r){__extends(t,r);function t(t){var e=r.call(this,n.CIRCLE)||this;e.radius=t;return e}t.prototype.clone=function(){return new t(this.radius)};return t}(t);$.ColliderCircle2D=e;var r=function(r){__extends(i,r);function i(t){var e=r.call(this,n.POLYGON)||this;e.vertexs=t;return e}i.prototype.clone=function(){var t=[];for(var e=0;e<this.vertexs.length;e++){t.push(this.vertexs[e].copy())}return new i(t)};return i}(t);$.ColliderPolygon2D=r;var i=function(){function t(t){this.bounds=new g;this.$shap=t}Object.defineProperty(t.prototype,"shap",{get:function(){return this.$shap},enumerable:true,configurable:true});return t}();$.Collision2D=i;var o=function(r){__extends(t,r);function t(t){var e=r.call(this,x.CIRCLE)||this;e.radius=t;return e}t.prototype.updateBounds=function(){this.bounds.updateBounds(this.x-this.radius,this.x+this.radius,this.y-this.radius,this.y+this.radius)};return t}(i);$.CollisionCircle2D=o;var u=function(){function t(t,e){this.useBox2d=false;this.$testAABB=true;this.$touching=false;if(t.collision.shap===x.CIRCLE){this.$a=t;this.$b=e;if(e.collision.shap===x.CIRCLE){this.$testFunc=this.$c2c;this.$testAABB=false}else if(e.collision.shap===x.RECTANGLE){this.$testFunc=this.$c2r}else{this.$testFunc=this.$c2p}}else if(t.collision.shap===x.RECTANGLE){if(e.collision.shap===x.CIRCLE){this.$a=e;this.$b=t;this.$testFunc=this.$c2r}else if(e.collision.shap===x.RECTANGLE){this.$a=t;this.$b=e;this.$testFunc=this.$r2r;this.$testAABB=false}else{this.$a=t;this.$b=e;this.$testFunc=this.$r2p}}else{this.$a=e;this.$b=t;if(e.collision.shap===x.CIRCLE){this.$testFunc=this.$c2p}else if(e.collision.shap===x.RECTANGLE){this.$testFunc=this.$r2p}else{this.$testFunc=this.$p2p}}}t.prototype.test=function(){var t=this.$a;var e=this.$b;if(t.enabled===false||e.enabled===false){return}var r,i;if(t.rigidbody!==null){r=t;i=e}else{r=e;i=t}if(r.rigidbody.target!==null&&r.rigidbody.target!==i){return}var n=this.$testAABB===false?true:L.bounds2Bounds(t.collision.bounds,e.collision.bounds);if(n===true){n=this.$testFunc.call(this,t.collision,e.collision)}if(n===true){if(this.$touching===false){this.$touching=true;this.doCollide(a.COLLISION_ENTER)}else{this.doCollide(a.COLLISION_STAY)}}else if(this.$touching===true){this.$touching=false;this.doCollide(a.COLLISION_EXIT)}};t.prototype.doCollide=function(t){var e=this.$a;var r=this.$b;if(t===a.COLLISION_ENTER){e.hitNum++;r.hitNum++;e.entity.onCollisionEnter(r.entity);r.entity.onCollisionEnter(e.entity)}else if(t===a.COLLISION_EXIT){e.hitNum--;r.hitNum--;e.entity.onCollisionExit(r.entity);r.entity.onCollisionExit(e.entity)}else{e.entity.onCollisionStay(r.entity);r.entity.onCollisionStay(e.entity)}};t.prototype.$c2c=function(t,e){return L.circle2Circle(t,e)};t.prototype.$c2r=function(t,e){return L.circle2Polygin(t,e)};t.prototype.$c2p=function(t,e){return L.circle2Polygin(t,e)};t.prototype.$r2r=function(){return L.bounds2Bounds(this.$a.collision.bounds,this.$b.collision.bounds)};t.prototype.$r2p=function(t,e){return L.polygon2Vertexs(e,t.vertexs)};t.prototype.$p2p=function(t,e){return L.polygon2Vertexs(t,e.vertexs)&&L.polygon2Vertexs(e,t.vertexs)};Object.defineProperty(t.prototype,"a",{get:function(){return this.$a},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"b",{get:function(){return this.$b},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"touching",{get:function(){return this.$touching},enumerable:true,configurable:true});return t}();$.CollisionContact2D=u;var l=function(n){__extends(t,n);function t(t){var e=n.call(this,x.POLYGON)||this;e.$tempVertexs=null;e.vertexs=[];e.segments=[];for(var r=0;r<t.vertexs.length;r++){var i=t.vertexs[r];e.vertexs.push(i.copy());e.segments.push(new C)}return e}t.prototype.updateBounds=function(){y.calculateBoundsForVertexs(this.vertexs,this.bounds)};t.prototype.updateVertexs=function(t){this.$tempVertexs=t};t.prototype.prepareVertexs=function(){for(var t=0;t<this.$tempVertexs.length;t++){var e=this.vertexs[t];var r=this.$tempVertexs[t];e.assign(r.x,r.y)}this.$tempVertexs=null};t.prototype.prepareSegments=function(){for(var t=0;t<this.vertexs.length;t++){var e=this.segments[t];e.a=this.vertexs[t];e.b=t>0?this.vertexs[t-1]:this.vertexs[this.vertexs.length-1];var r=this.vertexs[t];var i=t>0?this.vertexs[t-1]:this.vertexs[this.vertexs.length-1];this.segments[t].assign(r,i)}};Object.defineProperty(t.prototype,"modified",{get:function(){return this.$tempVertexs!==null},enumerable:true,configurable:true});return t}(i);$.CollisionPolygon2D=l;var h=function(r){__extends(t,r);function t(){var t=r.call(this,x.RECTANGLE)||this;t.vertexs=[];t.segments=[];for(var e=0;e<4;e++){t.vertexs.push(new E(0,0));t.segments.push(new C)}return t}t.prototype.updateBounds=function(){y.calculateBoundsForVertexs(this.vertexs,this.bounds)};t.prototype.prepareVertexs=function(){this.vertexs[0].assign(this.bounds.left,this.bounds.bottom);this.vertexs[1].assign(this.bounds.right,this.bounds.bottom);this.vertexs[2].assign(this.bounds.right,this.bounds.top);this.vertexs[3].assign(this.bounds.left,this.bounds.top)};t.prototype.prepareSegments=function(){for(var t=0;t<this.vertexs.length;t++){var e=this.segments[t];var r=this.vertexs[t];var i=t>0?this.vertexs[t-1]:this.vertexs[this.vertexs.length-1];e.assign(r,i)}};return t}(i);$.CollisionRectangle2D=h;var f=function(){function t(){}t.testPoint=function(t,e){if(e===void 0){e=0}var r=O.inst.transforms.slice(0);for(var i=0;i<r.length;i++){var n=r[i];var o=n.collision;if(e>0&&(n.layer&e)===0){continue}if(n.collision.shap===x.CIRCLE){if(L.pointInCircle(t,o)){return n}}else if(n.collision.shap===x.RECTANGLE){if(L.pointInRectangle(t,n.collision.bounds)){return n}}else{if(L.pointInPolygon(t,n.collision)){return n}}}return null};t.raycast=function(t,e,r,i,n){if(i===void 0){i=0}if(n===void 0){n=b.CLOSEST}var o=e.copy().normalize().mul(r).add(t);$.World2D.DEBUG===true&&S.drawLine(t,o,"#FF0000");var s=new C;s.assign(t,o);var a=new g;a.updateBounds(suncom.Mathf.min(t.x,o.x),suncom.Mathf.max(t.x,o.x),suncom.Mathf.min(t.y,o.y),suncom.Mathf.max(t.y,o.y));var u=O.inst.transforms;var l=null;var h=[];for(var f=0;f<u.length;f++){u[f].hitNum=0}for(var f=0;f<u.length;f++){var c=u[f];if(i>0&&(c.layer&i)===0){continue}if(L.bounds2Bounds(a,c.collision.bounds)===false){continue}if(l===null){l={type:m.NONE,transform:null,p1:new E(0,0),p2:new E(0,0),normal:null,distance:0}}if(c.collision.shap===x.CIRCLE){L.line2Circle(s,c.collision,l)}else{L.line2Polygon(s,c.collision,n,l)}if(l.type===m.NONE){continue}l.transform=c;c.hitNum=1;if(n===b.CLOSEST){if(h.length===1){h[0].transform.hitNum=0}h[0]=l;a.updateBounds(suncom.Mathf.min(t.x,l.p1.x),suncom.Mathf.max(t.x,l.p1.x),suncom.Mathf.min(t.y,l.p1.y),suncom.Mathf.max(t.y,l.p1.y))}else{h.push(l)}if(n===b.ANY){break}else if(n===b.CLOSEST||n===b.ALL_CLOSEST){l.distance=l.p1.distanceTo(t)}l=null}if(n===b.ALL_CLOSEST&&h.length>1){var p=[];while(h.length>1){var y=h[0];var d=0;for(var f=1;f<h.length;f++){var v=h[f];if(y===null||v.distance<y.distance){y=v;d=f}}h.splice(d,1);p.push(y)}p.push(h[0]);h=p}return h};return t}();$.Physics2D=f;var c=function(){function t(){this.$torque=180;this.target=null;this.moveSpeed=0}t.prototype.update=function(t){if(this.moveSpeed===0){return}if(this.target!==null&&this.target.enabled===false){this.target=null}var e=suncom.Pool.getItemByClass("world2d.Vector2D",E,[0,0]);if(this.target!==null){e.assign(this.target.x-this.transform.x,this.target.y-this.transform.y);var r=e.angle();if(this.$torque===180){this.transform.rotateTo(r)}else{var i=this.transform.rotation-suncom.Mathf.PI;var n=this.transform.rotation+suncom.Mathf.PI;if(r<i){r+=suncom.Mathf.PI2}else if(r>n){r-=suncom.Mathf.PI2}var o=r-this.transform.rotation;var s=suncom.Mathf.clamp(this.$torque*t*10,0,suncom.Mathf.PI);if(o<-s){this.transform.rotateBy(-s)}else if(o>s){this.transform.rotateBy(s)}else{this.transform.rotateBy(o)}}}e.assign(this.moveSpeed,0).rotate(this.transform.rotation);this.transform.moveBy(e.x*t,e.y*t);suncom.Pool.recover("world2d.Vector2D",e)};Object.defineProperty(t.prototype,"torque",{get:function(){return suncom.Mathf.r2d(this.$torque)},set:function(t){this.$torque=suncom.Mathf.d2r(t)},enumerable:true,configurable:true});return t}();$.Rigidbody2D=c;var C=function(){function t(){this.a=null;this.b=null;this.ab=new E(0,0)}t.prototype.assign=function(t,e){this.a=t;this.b=e;this.ab.assign(e.x-t.x,e.y-t.y);return this};return t}();$.Segment2D=C;var p=function(o){__extends(t,o);function t(t,e,r,i){var n=o.call(this)||this;n.$x=0;n.$y=0;n.$scaleTo=1;n.$rotateTo=0;n.$rotation=0;n.$enabled=true;n.$entity=null;n.$rigidbody=null;n.hitNum=0;n.$entity=t;n.$collider=e;n.$rigidbody=r;n.$collision=i;if(r!==null){r.transform=n}return n}t.prototype.transform=function(t){if(this.$rigidbody!==null){this.$rigidbody.update(t)}var e=this.$needUpdate();var r=this.$isModifiedByExtern();if(e===false&&r===false){return}this.$scale=this.$scaleTo;this.$radian=this.$rotateTo;this.$collision.x=this.$x;this.$collision.y=this.$y;if(r===false){this.$applyScale();this.$applyRotate();this.$applyPosition()}else{var i=this.$collision;i.prepareVertexs()}this.$updateCollision()};t.prototype.moveBy=function(t,e){this.$x+=t;this.$y+=e};t.prototype.moveTo=function(t,e){this.$x=t;this.$y=e};t.prototype.scaleBy=function(t){this.$scaleTo*=t};t.prototype.scaleTo=function(t){this.$scaleTo=t};t.prototype.rotateBy=function(t){this.$updateRadian(this.$rotateTo+t)};t.prototype.rotateTo=function(t){this.$updateRadian(t)};t.prototype.$updateRadian=function(t){if(t<0){t%=suncom.Mathf.PI2;t+=suncom.Mathf.PI2}else if(t>=suncom.Mathf.PI2){t%=suncom.Mathf.PI2}if(this.$rotateTo!==t){this.$rotateTo=t;this.$rotation=suncom.Mathf.r2d(t)}};t.prototype.$updateCollision=function(){this.$collision.updateBounds();if(this.$collision.shap===x.POLYGON){var t=this.$collision;t.prepareSegments()}else if(this.$collision.shap===x.RECTANGLE){var t=this.$collision;t.prepareVertexs();t.prepareSegments()}};t.prototype.$applyPosition=function(){if(this.$collider.shap!==n.CIRCLE){var t=this.$collision;for(var e=0;e<t.vertexs.length;e++){var r=t.vertexs[e];r.x+=this.$x;r.y+=this.$y}}};t.prototype.$applyRotate=function(){if(this.$collider.shap===n.POLYGON){var t=this.$collision;for(var e=0;e<t.vertexs.length;e++){var r=t.vertexs[e];r.rotate(this.$radian)}}};t.prototype.$applyScale=function(){if(this.$collision.shap===x.CIRCLE){var t=this.$collider;var e=this.$collision;e.radius=t.radius*this.$scale}else{var t=this.$collider;var e=this.$collision;for(var r=0;r<t.vertexs.length;r++){var i=t.vertexs[r];var n=e.vertexs[r];n.assign(i.x,i.y).mul(this.$scale)}}};t.prototype.$needUpdate=function(){if(this.$scale!==this.$scaleTo){return true}else if(this.$radian!==this.$rotateTo){return true}else if(this.$x!==this.$collision.x||this.$y!==this.$collision.y){return true}else{return false}};t.prototype.$isModifiedByExtern=function(){if(this.$collision.shap===x.POLYGON){var t=this.$collision;return t.modified}return false};t.prototype.getRotation=function(){return this.$rotation};t.prototype.setRotation=function(t){this.rotateTo(suncom.Mathf.d2r(t))};t.prototype.disabled=function(){this.$enabled=false};Object.defineProperty(t.prototype,"layer",{get:function(){return this.$layer},set:function(t){this.$layer=t;this.dispatchEvent(O.TRANSFORM_LAYER_CHANGED,this)},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"x",{get:function(){return this.$x},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"y",{get:function(){return this.$y},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"scale",{get:function(){return this.$scaleTo},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rotation",{get:function(){return this.$rotateTo},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"enabled",{get:function(){return this.$enabled},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"entity",{get:function(){return this.$entity},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"collider",{get:function(){return this.$collider},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"collision",{get:function(){return this.$collision},enumerable:true,configurable:true});Object.defineProperty(t.prototype,"rigidbody",{get:function(){return this.$rigidbody},enumerable:true,configurable:true});return t}(suncom.EventSystem);$.Transform2D=p;var E=function(){function r(t,e){this.x=t;this.y=e}r.prototype.assign=function(t,e){this.x=t;this.y=e;return this};r.prototype.add=function(t){this.x+=t.x;this.y+=t.y;return this};r.prototype.sub=function(t){this.x-=t.x;this.y-=t.y;return this};r.prototype.mul=function(t){this.x*=t;this.y*=t;return this};r.prototype.dot=function(t){return this.x*t.x+this.y*t.y};r.prototype.cross=function(t){return this.x*t.y-this.y*t.x};r.prototype.negate=function(){this.x=-this.x;this.y=-this.y;return this};r.prototype.rotate=function(t){var e=this.x;var r=this.y;var i=Math.cos(t);var n=Math.sin(t);this.x=e*i-r*n;this.y=e*n+r*i;return this};r.prototype.angle=function(){var t=Math.atan2(this.y,this.x);if(t<0){return t+2*Math.PI}else{return t}};r.prototype.zero=function(){this.x=this.y=0;return this};r.prototype.normal=function(){return new r(this.y,-this.x)};r.prototype.normalize=function(){var t=this.length();if(t<1e-9){return this}this.x/=t;this.y/=t;return this};r.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};r.prototype.lengthSquared=function(){return this.x*this.x+this.y*this.y};r.prototype.distanceTo=function(t){var e=this.x-t.x;var r=this.y-t.y;return Math.sqrt(e*e+r*r)};r.prototype.distanceToSquared=function(t){var e=this.x-t.x;var r=this.y-t.y;return e*e+r*r};r.prototype.copy=function(){return new r(this.x,this.y)};r.prototype.toString=function(){return"{"+this.x+","+this.y+"}"};r.add=function(t,e){return new r(t.x+e.x,t.y+e.y)};r.sub=function(t,e){return new r(e.x-t.x,e.y-t.y)};r.normal=function(t,e){return new r(e.y-t.y,t.x-e.x)};r.angle=function(t,e){var r=t.length();var i=e.length();if(r<=1e-9||i<1e-9){return 0}return Math.acos(t.dot(e)/(r*i))};return r}();$.Vector2D=E;var O=function(){function o(t){this.$detectors=[];this.$contacts=[];this.$transforms=[];o.inst=this;S.graphics=t;this.addDetector(s.DEFAULT,s.DEFAULT)}o.prototype.update=function(t){for(var e=0;e<this.$transforms.length;e++){this.$transforms[e].transform(t)}for(var e=0;e<this.$contacts.length;e++){this.$contacts[e].test()}o.DEBUG===true&&S.draw(this.$transforms)};o.prototype.addTransform=function(t,e){if(e===void 0){e=s.DEFAULT}t.layer=e;t.addEventListener(o.TRANSFORM_LAYER_CHANGED,this.$onTransformLayerChanged,this);for(var r=0;r<this.$transforms.length;r++){var i=this.$transforms[r];if(this.$shouldCollide(t.layer,i.layer)===true){var n=new u(t,i);this.$contacts.push(n)}}this.$transforms.push(t)};o.prototype.removeTransform=function(t){var e=this.$transforms.indexOf(t);if(e<0){return}t.disabled();this.$transforms.splice(e,1);t.removeEventListener(o.TRANSFORM_LAYER_CHANGED,this.$onTransformLayerChanged,this);for(var r=this.$contacts.length-1;r>-1;r--){var i=this.$contacts[r];if(i.a===t||i.b===t){if(i.touching===true){i.doCollide(a.COLLISION_EXIT)}this.$contacts.splice(r,1)}}};o.prototype.$onTransformLayerChanged=function(t){this.removeTransform(t);this.addTransform(t,t.layer)};o.prototype.addDetector=function(t,e){if(t>e){var r=t;t=e;e=r}if(this.$detectors[t]===void 0){this.$detectors[t]=[]}this.$detectors[t][e]=true};o.prototype.$shouldCollide=function(t,e){if(t>e){var r=t;t=e;e=r}if(this.$detectors[t]!==void 0&&this.$detectors[t][e]===true){return true}return false};Object.defineProperty(o.prototype,"transforms",{get:function(){return this.$transforms},enumerable:true,configurable:true});o.DEBUG=false;o.TRANSFORM_LAYER_CHANGED="world2d.TRANSFORM_LAYER_CHANGED";return o}();$.World2D=O;var L;(function(t){function e(t,e){return t.distanceToSquared(e)<=e.radius*e.radius}t.pointInCircle=e;function r(t,e){return t.x>=e.left&&t.x<=e.right&&t.y>=e.top&&t.y<=e.bottom}t.pointInRectangle=r;function u(t,e){var r=e.vertexs;var i=0;for(var n=0;n<r.length;n++){var o=r[n];var s=n===0?r[r.length-1]:r[n-1];if(o.x===s.x&&o.y===s.y){continue}i+=E.angle(E.sub(o,t),E.sub(s,t))}return suncom.Mathf.abs(suncom.Mathf.r2d(i)-360)<.01}t.pointInPolygon=u;function i(t,e){if(t.left>e.right||e.left>t.right||t.top>e.bottom||e.top>t.bottom){return false}return true}t.bounds2Bounds=i;function n(t,e){var r=e.x-t.x;var i=e.y-t.y;var n=t.radius+e.radius;if(r*r+i*i>n*n){return false}return true}t.circle2Circle=n;function o(t,e,r){var i=t.a.distanceToSquared(e);var n=t.b.distanceToSquared(e);var o=e.radius*e.radius;if(i<=o&&n<=o){r.p1.assign(t.a.x,t.a.y);r.type=m.CROSS}else{}return false}function s(t,e){var r=e.vertexs;var i=t.radius*t.radius;var n=null;var o=suncom.Mathf.MAX_SAFE_INTEGER;var s=false;for(var a=0;a<r.length;a++){var u=r[a];var l=u.distanceToSquared(t);if(l<=i){s=true;break}if(l<o){n=u;o=l}}if(s===true){return true}var h=new E(t.x,t.y);var f=n.copy();var c=new E(f.x-h.x,f.y-h.y);var p=c.normal();var y=c.copy().normalize().mul(t.radius).add(h);if(g([y],r,p)===false){return false}var d=[h,f];var v=e.segments;for(var a=0;a<v.length;a++){var x=v[a];if(x.ab.length()===0){continue}p.assign(x.ab.y,-x.ab.x).normalize().mul(t.radius);h.assign(t.x,t.y).add(p);f.assign(t.x,t.y).sub(p);if(g(d,r,x.ab)===false){return false}}return true}t.circle2Polygin=s;function g(t,e,r){var i=r.y/r.x;var n=r.x/r.y;var o=suncom.Mathf.MAX_SAFE_INTEGER;var s=suncom.Mathf.MIN_SAFE_INTEGER;var a=suncom.Mathf.MAX_SAFE_INTEGER;var u=suncom.Mathf.MIN_SAFE_INTEGER;var l=0,h=0;var f=false;if(i<-1||i>1){while(l<t.length||h<e.length){if(l<t.length){var c=t[l];var p=c.x-n*c.y;if(o>p){o=p}if(s<p){s=p}l++}if(h<e.length){var c=e[h];var p=c.x-n*c.y;if(a>p){a=p}if(u<p){u=p}h++}if((s<a||o>u)===false){f=true;break}}}else{while(l<t.length||h<e.length){if(l<t.length){var c=t[l];var p=c.y-i*c.x;if(o>p){o=p}if(s<p){s=p}l++}if(h<e.length){var c=e[h];var p=c.y-i*c.x;if(a>p){a=p}if(u<p){u=p}h++}if((s<a||o>u)===false){f=true;break}}}return f}function a(t,e){var r=t.vertexs;var i=t.segments;for(var n=0;n<i.length;n++){var o=i[n];if(o.ab.length()===0){continue}if(g(r,e,i[n].ab)===false){return false}}return true}t.polygon2Vertexs=a;function l(t,e,r){var i=e.radius*e.radius;var n=t.a.distanceToSquared(e);var o=t.b.distanceToSquared(e);if(n<=i&&o<=i){r.p1.assign(t.a.x,t.a.y);r.type=m.CROSS;return true}var s=t.ab.normal().normalize().mul(e.radius);var a=new E(e.x,e.y).add(s);var u=new E(e.x,e.y).sub(s);var l={p:new E(0,0),type:m.NONE};d(t.a,t.ab,a,u,l);if(l.type===m.NONE){return false}l.type=m.NONE;var h=l.p.copy().sub(e).lengthSquared();var f=Math.sqrt(i-h);s.assign(t.ab.x,t.ab.y).normalize().mul(f);a=l.p.copy().add(s);u=l.p.copy().sub(s);var c=v(a.x,t.a.x,t.b.x)&&v(a.y,t.a.y,t.b.y);var p=v(u.x,t.a.x,t.b.x)&&v(u.y,t.a.y,t.b.y);if(c&&p){y(t.a,a,u,r);r.type=m.CROSS_2}else if(c){r.p1=a;r.type=m.CROSS}else if(p){r.p1=u;r.type=m.CROSS}else{return false}}t.line2Circle=l;function h(t,e,r,i){var n=e.segments;var o={p:new $.Vector2D(0,0),type:m.NONE};for(var s=0;s<n.length;s++){var a=n[s];if(r===b.ANY||r===b.ALL){if(f(t.ab,t.a,t.b,a.ab,a.a,a.b,null)){i.type=m.CROSS;break}}else{f(t.ab,t.a,t.b,a.ab,a.a,a.b,o);if(o.type===m.CROSS){if(i.type===m.NONE){i.type=m.CROSS;i.p1.assign(o.p.x,o.p.y)}else{i.type=m.CROSS_2;i.p2.assign(o.p.x,o.p.y)}if(i.type===m.CROSS_2){break}o.type=m.NONE}}}if(i.type===m.NONE){if(u(t.a,e)&&u(t.b,e)){i.p1.assign(t.a.x,t.a.y);i.type=m.CROSS}}else if(i.type===m.CROSS_2){y(t.a,i.p1,i.p2,i)}return i.type!==m.NONE}t.line2Polygon=h;function y(t,e,r,i){if(r.distanceToSquared(t)<e.distanceToSquared(t)){i.p1=r;i.p2=e}else{i.p1=e;i.p2=r}}function f(t,e,r,i,n,o,s){var a;if(t.x===0&&i.x===0){if(e.x===n.x&&(v(e.y,n.y,o.y)||v(r.y,n.y,o.y)||v(n.y,e.y,r.y)||v(o.y,e.y,r.y))){a=m.OVERLAP}else{a=m.NONE}}else if(t.y===0&&i.y===0){if(e.y===n.y&&(v(e.x,n.x,o.x)||v(r.x,n.x,o.x)||v(n.x,e.x,r.x)||v(o.x,e.x,r.x))){a=m.OVERLAP}else{a=m.NONE}}else if(d(n,i,e,r,s)&&d(e,t,n,o,s)){a=m.CROSS}else{a=m.NONE}if(s!==null&&s.type!==a){s.type=a}return a!==m.NONE}t.line2Line=f;function d(t,e,r,i,n){if(e.x===0){return v(t.x,r.x,i.x)&&p(t.x,t.x,r.y,i.y,n)}else if(e.y===0){return v(t.y,r.y,i.y)&&p(r.x,i.x,t.y,t.y,n)}else{var o=e.y/e.x;if(o>-1&&o<1){var s=t.y-o*t.x;var a=r.y-o*r.x;var u=i.y-o*i.x;return v(s,a,u)&&x(s,a,u,r,i,n)}else{var l=e.x/e.y;var h=t.x-l*t.y;var f=r.x-l*r.y;var c=i.x-l*i.y;return v(h,f,c)&&x(h,f,c,r,i,n)}}}t.isLineBetweenPoints=d;function v(t,e,r){if(e<r){return e<=t&&t<=r}else{return r<=t&&t<=e}}t.isInRange=v;function p(t,e,r,i,n){if(n!==null&&n.type===m.NONE&&t===e&&r===i){n.p.assign(t,r);n.type=m.CROSS}return true}function x(t,e,r,i,n,o){if(o!==null&&o.type===m.NONE){o.p=new E(n.x-i.x,n.y-i.y).mul((t-e)/(r-e)).add(i);o.type=m.CROSS}return true}})(L=$.CollisionResolution2D||($.CollisionResolution2D={}));var S;(function(a){function t(){a.graphics.clear()}a.clear=t;function e(t){for(var e=0;e<t.length;e++){var r=t[e];var i=r.collision.bounds;a.drawRect(i.left,i.top,i.right-i.left,i.bottom-i.top,"#FF0000")}for(var e=0;e<t.length;e++){var r=t[e];if(r.collision.shap===x.CIRCLE){var n=r.collision;a.drawCircle(r.x,r.y,n.radius,"#FF0000")}else if(r.collision.shap===x.POLYGON){var n=r.collision;a.drawPolygon(0,0,n.vertexs,"#FF0000")}else{var n=r.collision;a.drawPolygon(0,0,n.vertexs,"#FF0000")}}for(var e=0;e<t.length;e++){var r=t[e];var o=r.hitNum===0?"#0000FF":"#00FF00";if(r.collision.shap===x.CIRCLE){var n=r.collision;a.drawCircle(r.x,r.y,n.radius,o)}else if(r.collision.shap===x.POLYGON){var n=r.collision;a.drawPolygon(0,0,n.vertexs,o)}else{var i=r.collision.bounds;a.drawRect(i.left,i.top,i.right-i.left,i.bottom-i.top,o)}}}a.draw=e;function r(t,e,r){a.graphics.drawLine(t.x,t.y,e.x,e.y,r)}a.drawLine=r;function i(t,e){var r=t.copy().normalize().mul(1e3);a.graphics.drawLine(t.x,t.y,-t.x,-t.y,e)}a.drawNormal=i;function n(t,e,r,i,n){a.graphics.drawRect(t,e,r,i,void 0,n)}a.drawRect=n;function o(t,e,r,i){a.graphics.drawCircle(t,e,r,void 0,i)}a.drawCircle=o;function s(t,e,r,i){for(var n=0;n<r.length;n++){var o=r[n];var s=n===0?r[r.length-1]:r[n-1];a.graphics.drawLine(o.x+t,o.y+e,s.x+t,s.y+e,i)}}a.drawPolygon=s})(S=$.DrawAPI2D||($.DrawAPI2D={}));var y;(function(t){function e(t,e){var r=t[0];var i=r.x;var n=r.x;var o=r.y;var s=r.y;for(var a=1;a<t.length;a++){var u=t[a];if(i>u.x){i=u.x}else if(n<u.x){n=u.x}if(o>u.y){o=u.y}else if(s<u.y){s=u.y}}e.updateBounds(i,n,o,s)}t.calculateBoundsForVertexs=e})(y=$.Helper2D||($.Helper2D={}))})(world2d||(world2d={}));